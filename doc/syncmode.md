## sync mode

#### ethereum

full mode: 这种模式通过下载区块头，和区块体来构建区块链，同步的过程就和普通的区块插入的过程一样，包括区块头的验证，交易的验证，交易执行，账户状态的改变等操作，这其实是一个比较消耗CPU和磁盘的一个过程。除非特殊需要，一般已经很少采用这种同步方式；

fast mode: 简单的说 fast sync的模式会下载区块头，区块体和收据， 插入的过程不会执行交易，然后在一个区块高度(最高的区块高度 - 1024)的时候同步所有的账户状态，后面的1024个区块会采用full mode的方式来构建。 这种模式会加区块的插入时间，同时不会产生大量的历史的账户信息。会相对节约磁盘， 但是对于网络的消耗会更高。因为需要下载收据和状态。快速同步的算法概要如下：

- 与原有的同步类似，下载组成区块链的区块头和区块body；
- 类似于原有的同步，验证区块头的一致性（POW，总难度等）；
- 下载由区块头定义的交易收据,而不是处理区块；
- 存储下载的区块链和收据链，启用所有历史查询；
- 当链条达到最近的状态（头部 - 1024个块，也即是**pivot point**）时，暂停同步： 
  - 获取由 pivot point定义的区块的完整的Merkel Patricia Trie状态；
  - 对于Merkel Patricia Trie里面的每个账户，获取他的合约代码和中间存储的Trie；
- 当Merkel Patricia Trie下载成功后，将pivot point定义的区块作为当前的区块头；
- 通过像原有的同步一样对其进行完全处理，导入所有剩余的块（1024）

#### taucoin

taucoin的同步基本上借鉴ethereum的同步过程，区块同步之前会有一个选链的过程，具体可参考[选链过程](https://github.com/Tau-Coin/taucoin-ipfs-docs/blob/master/doc/selectchain.md)，一般选链机制包括两个部分，发现的链与本地链的区块高度差在mutable range之外进行的投票选择机制和高度差在mutable range之内的最长链快速选择机制，理论上，离最新高度越远的区块共识度越高，mutable range之外的区块，全网具有的一致性应该达到一定的标准（一致性标准矿工可以根据个人情况指定，比如为90%），否则要根据社区信息进行人工干预。选链一旦完成就可以开始同步区块，根据是否验证历史区块也是分为full mode和fast mode两种模式:

full mode: 先是对区块高度差在mutable range的情况进行投票选择，同步时先递归同步区块头，直到到达创世区块，然后从创世区块开始，边同步区块体，边执行交易；同步的高度差小于mutable range之后，进入最长链快速同步阶段，同样也是先同步区块头，再同步区块体，同时执行交易直到最新区块，新区块来了接着执行验证；

fast mode: 和full mode基本相同，唯一的区别是第一次投票同步时会选择一个pivot point，在这个高度进行statedb的同步，在此高度之后的区块都会执行交易。为了选择fast mode的pivot point，我们将第一次投票出来的达到一致性标准的区块高度记为h1，则投票有效的情况下应有 0<=h1<=mutable range，为了确保pivot point在正确的社区链mutable range之外，将pivot point设置为**h1 - mutable range**。