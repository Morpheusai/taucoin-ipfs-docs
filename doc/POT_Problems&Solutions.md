### POT_Problems&Solutions

在主流的共识机制中，相比于pow来说，pot和pos是一种很多方面更加接近的共识，它们在很多方面有很大的优势，比如轻便、节能等，但同时也带来了一些很难处理的难题，需要更好的处理机制去解决。下面主要从三个方面，讨论pot带来的问题与可能的解决方案：

#### incentive for storage

​	对于存储问题的激励，源于对stateless client的讨论，要实现stateless client，需要节点能跳过对区块链历史state的同步，从而能快速挖矿。不同步state但是仍然要验证交易，如果只获取验证交易所需的部分state，就能开启快速挖矿。但理论上，即使获取部分state，也需要有节点提供这些state，仍然需要有statefull节点，那么到底有谁来提供这些state?

​	Vitalik 为eth2.0提出了一些可能的解决方案，比如通过全节点或者矿工随机存储提供、dapp客户端随机存储等方案，但这些方案会陷入经济学上常见的“搭便车”难题，人总是喜欢投机的，如果有可能，大家都愿意享受伸手可得的好处，而不愿付出，每个节点都会倾向于不提供这些state数据。对于taucoin来说，存储提供state的任务，干脆直接交给那些持币较多的人，这些人由于持币较多是有意愿提供state，来维护整个社区生态良好运作的，这也是pos的基础。持币较多的人通过提供state数据，让各个矿工都能轻松作为stateless client，从而发展壮大社区，自己也会很大比例的从中获利。同时，由于taucoin论坛对相应主题的回复，会使得主题发起者分享交易费，主题发起者提供state等数据，能帮助矿工或者论坛参与者更积极地参与，从而主题发起者就可以分得更多的交易费。此外，block中携带的中继节点ID信息，给那些提供中继或者state数据服务的节点，也提供了一个链上的支付通道，使得节点之间支付服务模式得以有效实施。

#### long range fork

​	long range fork，也可以理解为常说的“私有链攻击”或者“历史攻击”问题，经常是恶意的节点，通过伪造符合共识验证规则的区块，企图替换主链的很多区块，这类攻击往往是恶意进行的。攻击节点甚至可以从创世区块开始，在私底下刷交易来增长算力，然后挖出许多块，等到链足够长之后，将其在网络上广播，其它节点完全能直接验证通过这条隐藏的链，从而对社区主链造成打击，这种攻击成本是非常低的，几乎可以忽略不计。并且，这种攻击对于长时间在线的节点和新上线的节点的效果也是不同的，长时间在线的节点通过现有链的情况是有手段能识别出隐藏链的，而新上线的节点上线时是没有办法做到的这一点的，只能按照最长链的原则来选链，这样就很容易被这种伪造的长链分离出社区。

​	pot和pos都存在这种攻击的可能性，Vitalik 为eth2.0提出的Weak Subjectivity指导思想是这个问题的一种可能的解决方案，可以理解为让人一定程度参与到节点的行为抉择中，这种方式得到的链，社交属性某种程度上更多一点儿。考虑到taucoin是一条侧重于论坛应用的链，具有很强的社交属性，我们也可以让社交参与链的治理，具体体现在：[节点投票](https://github.com/Tau-Coin/taucoin-ipfs-docs/blob/master/doc/selectchain.md)和[TaPoS](https://github.com/Tau-Coin/taucoin-ipfs-docs/blob/master/doc/TaPoS.md)。简单来说，对于新上线的节点来说，由于有long range fork的威胁，首先需要有一个识别社区主链的过程，由于社区主链在社区获得的共识程度最高，因而通过聆听社区的声音也即是投票，某种程度上可以解决新上线节点识别社区主链的难题；同时，考虑到论坛的社交以交易来承载，如果在交易中增加社区主链历史的确认，也即是TaPos，通过在交易中引用社区主链区块上的hash，这样的话社区每个实体只要进行交流互动，就会通过交易对主链历史进行一次确认，这个过程相当于对主链进行一次投票，交流越多，对社区主链的共识度也越多，而对于隐藏的long rang fork，每个社区实体是没办法引用到链上的hash的，自然也没办法得到最多社区实体的承认，这样长时间在线的节点就可以轻易避免long range fork的攻击了。

#### short range fork

​	short range fork，这个问题是一个链应对多分叉的处理方式问题，它不是一个人为攻击的问题，而是一个链的模型是否正确的问题。由于short range fork在矿工追求最大化利益的前提下是客观存在的，一条链能否随着长度的增加是收敛还是发散的，如果不能收敛，则可能会产生无数条同样长度的链，导致主链识别困难。pow由于挖矿成本的存在，在一些成为最长链可能性小的分叉上挖矿是不划算的，而pot和pos出块近乎零成本，为了确保最大的收益，完全有激励在任何有可能成为最长链的分叉上继续出块，如果每个节点都是如此，那么一条链很可能长成一个灌木丛向周围各个方向同步增长，而不是像竹子那样只向上一个方向生长。这个问题的产生是因为出块无成本，并且“nothing at stake”，因此矿工会有double voting的激励。

​	在eth的Casper方案中通过下注共识 (Gambling on Consensus)来解决，Casper要求验证人将保证金中的大部分对共识结果进行下注。而共识结果又通过验证人的下注情况形成：验证人必须猜测其他人会赌哪个块胜出，同时也下注这个块。如果赌对了，他们就可以拿回保证金外加交易费用，也许还会有一些新发的货币；如果下注没有迅速达成一致，他们只能拿回部分保证金。因此数个回合之后验证人的下注分布就会收敛。POW共识同样可以理解为是一个下注机制：矿工选择一个块基于它进行挖矿，也就是赌这个块会成为主链的一部分；如果赌对了，他可以收到奖励，而如果赌错了，他会损失电费。只要所有的矿工都将他们的算力下注到同一条链上，使这条链拥有最多的工作量（即时算力下注的预测，也是算力下注的结果），共识就是安全的。

​	对于出块无成本的共识，显然也需要让错误的出块付出代价才合理，taucoin也不例外。taucoin可以通过一种举证机制来实现链的收敛，具体如下：要求每个出块者质押一定的币，N个块后返还，同时在区块里增加一个指向非主链区块的引用作为该矿工的举证，如果有矿工在与主链区块高度接近的非社区主链上出块，则该区块可以被其它矿工举证，一旦经过证实，则将被举证矿工的质押赠送给举证矿工，以此来消除矿工在非主链上出块的积极性，从而使得链随着高度的增加总是收敛的。



#### 参考文章

- https://blog.ethereum.org/2014/11/25/proof-stake-learned-love-weak-subjectivity/
- https://talk.peercoin.net/t/can-tapos-recent-block-hashes-in-transactions-be-added-to-peercoin-to-improve-fork-resolution/8089
- https://docs.ethhub.io/ethereum-roadmap/ethereum-2.0/stateless-clients/

